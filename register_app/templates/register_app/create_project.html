{% extends "base.html" %}

{% load static %}

{% block content %}
<style>
    /* Styles for the form and its components */
    form {
        max-width: 600px;
        margin: 0 auto;
    }
    label {
        display: block;
        margin-top: 15px;
    }
    input, select, textarea {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .location-form {
        margin-top: 20px;
    }
    .location-form:not(:first-of-type) {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
    .errorlist {
        color: red;
        list-style-type: none;
        padding: 0;
    }
    .errorlist li {
        text-transform: capitalize;
        text-decoration: none;
    }
</style>

<h2 class="m-4">Create New Project</h2>

<!-- Display errors -->
{% if form.errors %}
    <ul class="list-unstyled">
    {% for field, errors in form.errors.items %}
        {% for error in errors %}
            <li class="text-danger">{{ error }}</li>
        {% endfor %}
    {% endfor %}
    </ul>
{% endif %}

{% if formset.errors %}
    <ul class="list-unstyled">
    {% for error in formset.errors %}
        <li class="text-danger">{{ error }}</li>
    {% endfor %}
    </ul>
{% endif %}

<form id="create_project" method="post" action="{% url 'create_project' %}">
    {% csrf_token %}
    <!-- Add labels and form controls with Bootstrap classes -->
    <label for="{{ form.project_name.id_for_label }}" class="form-label">Project Name</label>
    {{ form.project_name }}
    
    <label for="{{ form.project_code.id_for_label }}" class="form-label">Project Code</label>
    {{ form.project_code }}

    <label for="{{ form.project_status.id_for_label }}">Project Status</label>
    {{ form.project_status }}

    <label for="{{ form.project_url.id_for_label }}">Project URL</label>
    {{ form.project_url }}

    <label for="{{ form.site_manager_name.id_for_label }}">Site Manager Name</label>
    {{ form.site_manager_name }}

    <label for="{{ form.site_manager_email.id_for_label }}">Site Manager Email</label>
    {{ form.site_manager_email }}

    <label for="{{ form.project_manager_name.id_for_label }}">Project Manager Name</label>
    {{ form.project_manager_name }}

    <label for="{{ form.project_manager_email.id_for_label }}">Project Manager Email</label>
    {{ form.project_manager_email }}
    
    {{ formset.management_form }}
    
    <div id="empty-form" style="display: none;">
        <label for="id_form-__prefix__-name">Location Name</label>
        <input type="text" id="id_form-__prefix__-name" name="form-__prefix__-name">
        <label for="id_form-__prefix__-address">Location Address</label>
        <input type="text" id="id_form-__prefix__-address" name="form-__prefix__-address">
        <label for="id_form-__prefix__-description">Location Description</label>
        <textarea id="id_form-__prefix__-description" name="form-__prefix__-description"></textarea>
    </div>
    <div id="locationFormSet">
        <!-- Loop through each form in the formset -->

        {% for location_form in formset %}
            <div class="location-form">
                <!-- Manually render location form fields with custom labels -->
                <label for="{{ location_form.name.id_for_label }}">Location Name</label>
                {{ location_form.name }}
                <label for="{{ location_form.address.id_for_label }}">Location Address</label>
                {{ location_form.address }}
                <label for="{{ location_form.description.id_for_label }}">Location Description</label>
                {{ location_form.description }}
            </div>
        {% endfor %}


    </div>
        <!-- Your empty form template here -->
    </div>
    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Create</button>
        <button type="button" id="addLocationButton" class="btn btn-secondary">+ Location</button>
    </div>
</form>

<script>
    // Function to add a new location to the form
    function addLocation() {

        const formSetDiv = document.getElementById('locationFormSet');
        
        // Create the container div for the new location
        const locationDiv = document.createElement('div');
        locationDiv.className = 'location-form';
        
        // Create the label and input for the location name
        let label = document.createElement('label');
        label.innerText = 'Location Name';
        locationDiv.appendChild(label);
        
        let input = document.createElement('input');
        input.type = 'text';
        input.name = 'form-' + formSetDiv.children.length + '-name';
        locationDiv.appendChild(input);
        
        // Create the label and input for the location address
        label = document.createElement('label');
        label.innerText = 'Location Address';
        locationDiv.appendChild(label);
        
        input = document.createElement('input');
        input.type = 'text';
        input.name = 'form-' + formSetDiv.children.length + '-address';
        locationDiv.appendChild(input);
        
        // Create the label and textarea for the location description
        label = document.createElement('label');
        label.innerText = 'Location Description';
        locationDiv.appendChild(label);
        
        let textarea = document.createElement('textarea');
        textarea.name = 'form-' + formSetDiv.children.length + '-description';
        locationDiv.appendChild(textarea);
        
        // Append the created location div to the form
        formSetDiv.appendChild(locationDiv);
    }
    
    document.getElementById('addLocationButton').addEventListener('click', addLocation);
</script>


{% endblock %}
